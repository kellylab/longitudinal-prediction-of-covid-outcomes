# Trajectory analysis
Scripts to analyze and plot the trajectory of clinical data (IgG EC50s, White Blood Cells -WBC-, Neutrophils, Lymphocytes, Eosinophils, Platelets, Blood Urea Nitrogen -BUN- and C-reactive protein -CRP-.

**Contents:**
- [Scripts](#Scrips)
- [Input](#Input)
- [Output](#Output)
- [Contact](#Contact)

# Scripts

### IgG_traj_classif.ipynb
**Script to categorize the sustained IgG response.**
> <p>Categorization of IgG response into low, medium and high categories is based on a sustained IgG response, as dictated by the EC50 values during hospitalization. Patients with short hospitalization stays (fewer than seven days) were discarded. IgG EC50 values at any given day were averaged using a 5-day sliding window. Categorization uses EC50 lower and upper thresholds (-log10(EC50) = 2.91 and 4.47) that correspond to the 25th and 75th EC50 percentiles respectively. Categorized patients are required to show IgG EC50 values for at least for 5 consecutive days within the range delimited by the thresholds (low: EC50 ≤ 2.91; medium: 2.91 > EC50 ≤ 4.47; and high: EC50 > 4.47). In order to minimize potential categorization errors due to varying IgG titers towards the end of the hospitalization stay (e.g. patients with sustained medium IgG titer showing higher IgG titers at the end of the hospitalization), the sustained IgG titer is required to extend to the end of the hospitalization stay.</p>

### EC50_analyze.ipynb
**Script to analyze the temporal association between IgG and various patient categories**
> <p>This script performs multiple operations to: i) give an overview of the IgG data in hospitalized patients; ii) plot the EC50 trajectory for each patient, iii) plot the IgG median trajectories for groups of patients (patients were grouped by survival, severity, oxygenation, ethnicity and race) and; iv) perform day-to-day statistical analyses.</p>
> <p>Most operations are performed on EC50 values averaged using a 5-day sliding window</p>

### ClinicVar_analyze.ipynb
**Script to analyze the temporal association between other clinical variables and various patient categories**
> <p>Clinical variables: White Blood Cells (WBC), Neutrophils, Lymphocytes, Eosinophils, Platelets, Blood Urea Nitrogen (BUN) and C-reactive protein (CRP)</p>
> <p>This script performs multiple operations on a user-specified clinical variable to: i) give an overview of its coverage in hospitalized patients; ii) plot its trajectory for each patient, iii) plot its median trajectory for groups of patients (patients were grouped by survival, severity, oxygenation, ethnicity and race) and; iv) perform day-to-day statistical analyses.</p>
> <p>Most operations are performed on EC50 values averaged using a 5-day sliding window</p>

# Input
#### ec50_values.xlsx
> <p>IgG EC50 values for a given patient at a particular hospitalization day post-symptom-onset. Elisa experiments were run in duplicates (run1 & run2), so for each patient-day there are two EC50s described</p>
> <p>Each sample is identified by the internal patient number and the day post-symptom-onset (e.g. 7-12 corresponds to patient 7 at day 12)</p>
> <p>This file is processed by "IgG_traj_classif.ipynb" and "EC50_analyze.ipynb"</p>

### clinical_data.xlsx
> <p>This file describe the levels of other clinical variables longitudinally monitored during hospitalization</p>
> <p>Clinical variables: White Blood Cells (WBC; 10^9 cells/L), Neutrophils (10^9 cells/L), Lymphocytes (10^9 cells/L), Eosinophils (10^9 cells/L), Platelets (10^9 cells/L), Blood Urea Nitrogen (BUN; ml/dl) and C-reactive protein (CRP; mg/dl)</p>
> <p>Each sample is identified by the internal patient number and the day post-symptom-onset (e.g. 7-12 corresponds to patient 7 at day 12)</p>
> <p>This file is processed by "ClinicVar_analyze.ipynb"</p>

### [ethnicity, oxygensuppl, race, severity]_category.xlsx
> <p>Set of files categorizing patients according to demographics and disease outcome</p>
> <p>These files are processed by "IgG_traj_classif.ipynb" & "ClinicVar_analyze.ipynb"</p>

#### ethnicity_category.xlsx</p>
> <p>Hispanics(1), Non-hispanics(0), Unknown(.)</p>
#### oxygensuppl_category.xlsx
> <pColumns describe the different oxygenation supply administered (1: administered treatment; 0: non-administered treatment)</p>
#### race_category.xlsx
> <p>Black(1), White(2), Other(3), Unknown(.)</p>
#### severity_category.xlsx
> <p>Disease outcome for each hospitalized patient</p>

# Output
## IgG_traj_cat
<p>Output generated by "IgG_traj_classif.ipynb"</p>


- ec50_df.xlsx: Ec50 values for each patient(row) at any given day post-symptom-onset(column)
- EC50_df_window5_minuslog10.xlsx: Ec50 values (averaged using 5-day sliding window, -log10 transformed) for each patient(row) at any given day post-symptom-onset(column).
- ec50_df_clean: Ec50 values for each patient(row) at any given day post-symptom-onset(column). Patients with < 7 hospitalization days were removed.
- ec50_df_clean_average_log.xlsx: Ec50 values (averaged using 5-day sliding window, -log10 transformed) for each patient(row) at any given day post-symptom-onset(column).Patients with < 7 hospitalization days were removed.
- ec50_histogram.pdf: Histogram of Ec50 values (-log10, averaged using a 5-day sliding window).  Patients with < 7 hospitalization days were removed.
- IgG_response_categories.txt: Categorization each patient based on their sustained IgG response
- patients_with_poor_coverage.txt: Patients that were discarded since they were hospitalized less than 7 days
- *_response.pdf: plotting together the Ec50 trajectories of all patients falling into the same sustained IgG response category


## [EC50, WBC, neutrophil, lymphocyte, eosinophil, platelet, BUN, CRP]
<p>Plot and analysis of longitudinally monitored clinical parameters</p>


### variable_dataframe.xlsx
> <p>Variable values (-log10 transformed) for each patient(row) at any given day post-symptom-onset(column)</p>
### variable_win5_dataframe.xlsx
> <p>Variable values (-log10 transformed & averaged using a 5day sliding window) for each patient(row) at any given day post-symptom-onset(column)</p>
### overview[_win5]
- variable_data_coverage: Heatmap describing the coverage of the variable during hospitalization (Row: patients, Columns: day post-symptom-onset)
- variable_histogram_patients_per_onsetday: Number of samples (patients) for which the variable was measured at a given day during hospitalization
- variable_histogram_patients_per_readoutDays: Number of days and samples (patients) where variable was measured during hospitalization

### severity_win5
- variable_lineplot_severity_5cat_win5_mean.pdf
- variable_severity_5cat_pairw_stats_win5_pvalcor.xlsx
- variable_lineplot_severity_5cat_win5_median.pdf
- variable_severity_5cat_window5.xlsx
- variable_severity_5cat_pairw_stats_win5.txt
- severity_5cat_boxplot_win5

### survival_win5
- variable_survival.xlsx
- variable_survival_lineplot_trajectory_win5_median.pdf
- variable_survival_boxplot_win5
- variable_survival_pairw_stats_win5.txt
- variable_survival_lineplot_trajectory_win5_mean.pdf
- variable_survival_pairw_stats_win5_pvalcor.xlsx

### ethnicity_win5
- ethinicity_boxplot_win5
- variable_ethnicity_pairw_stats_win5_pvalcor.xlsx
- variable_lineplot_ethnicity_3cat_win5_mean.pdf
- variable_ethnicity_pairw_stats_win5.txt
- variable_ethnicity_win5.xlsx
- variable_lineplot_ethnicity_3cat_win5_median.pdf

### race_win5
- ethinicity_boxplot_win5
- variable_lineplot_race_win5_median.pdf
- variable_race_pairw_stats_win5_pvalcor.xlsx
- variable_lineplot_race_win5_mean.pdf
- variable_race_pairw_stats_win5.txt
- variable_race_win5.xlsx

### time_plot[_win5]
> <p>Trajectory of a given variable during hospitalization for each patient</p>


# Contact
<p>For any question regarding scripts and information contained in this directory, please contact Gorka Lasso: gorka.lasso[at]gmail.com</p>
